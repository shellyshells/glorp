{{define "content"}}
<div class="form-container">
    <div class="form-header">
        <h1><i class="fas fa-edit"></i> Edit Thread</h1>
        <p>Update your thread information</p>
    </div>

    <form id="thread-form" class="thread-form">
        <div class="form-group">
            <label for="title">Thread Title *</label>
            <input type="text" id="title" name="title" required maxlength="200" value="{{.Thread.Title}}">
            <small>Maximum 200 characters</small>
        </div>

        <div class="form-group">
            <label for="description">Description *</label>
            <textarea id="description" name="description" rows="6" required>{{.Thread.Description}}</textarea>
            <small>Provide a detailed description of what you want to discuss</small>
        </div>

        <div class="form-group">
            <label for="tags">Tags/Categories</label>
            <div class="tag-selector">
                {{range .Tags}}
                <label class="tag-checkbox">
                    <input type="checkbox" name="tags" value="{{.ID}}" 
                           {{range $.Thread.Tags}}{{if eq .ID $.ID}}checked{{end}}{{end}}>
                    <span class="checkmark"></span>
                    {{.Name}}
                </label>
                {{end}}
            </div>
            <small>Select relevant categories for your thread</small>
        </div>

        <div id="error-message" class="error-message" style="display: none;"></div>

        <div class="form-actions">
            <a href="/threads/{{.Thread.ID}}" class="btn btn-outline">
                <i class="fas fa-times"></i> Cancel
            </a>
            <button type="submit" class="btn btn-primary">
                <i class="fas fa-save"></i> Update Thread
            </button>
        </div>
    </form>
</div>

<script>
document.getElementById('thread-form').addEventListener('submit', async function(e) {
    e.preventDefault();
    
    const formData = new FormData(this);
    const selectedTags = Array.from(formData.getAll('tags')).map(id => parseInt(id));
    
    const data = {
        title: formData.get('title'),
        description: formData.get('description'),
        tags: selectedTags
    };
    
    const errorDiv = document.getElementById('error-message');
    
    try {
        const response = await fetch('/api/threads/{{.Thread.ID}}', {
            method: 'PUT',
            headers: {
                'Content-Type': 'application/json',
            },
            body: JSON.stringify(data)
        });
        
        if (response.ok) {
            window.location.href = '/threads/{{.Thread.ID}}';
        } else {
            const result = await response.text();
            errorDiv.textContent = result;
            errorDiv.style.display = 'block';
        }
    } catch (error) {
        errorDiv.textContent = 'Failed to update thread. Please try again.';
        errorDiv.style.display = 'block';
    }
});
</script>
{{end}}