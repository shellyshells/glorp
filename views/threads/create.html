{{define "content"}}
<div class="form-container">
    <div class="form-header">
        <h1><i class="fas fa-plus"></i> Create New Thread</h1>
        <p>Start a new discussion in the community</p>
    </div>

    <form id="thread-form" class="thread-form">
        <div class="form-group">
            <label for="title">Thread Title *</label>
            <input type="text" id="title" name="title" required maxlength="200" placeholder="Enter a descriptive title for your thread">
            <small>Maximum 200 characters</small>
        </div>

        <div class="form-group">
            <label for="description">Description *</label>
            <textarea id="description" name="description" rows="6" required placeholder="Describe your thread topic in detail..."></textarea>
            <small>Provide a detailed description of what you want to discuss</small>
        </div>

        <div class="form-group">
            <label for="tags">Tags/Categories</label>
            <div class="tag-selector">
                {{range .Tags}}
                <label class="tag-checkbox">
                    <input type="checkbox" name="tags" value="{{.ID}}">
                    <span class="checkmark"></span>
                    {{.Name}}
                </label>
                {{end}}
            </div>
            <small>Select relevant categories for your thread</small>
        </div>

        <div id="error-message" class="error-message" style="display: none;"></div>

        <div class="form-actions">
            <button type="button" onclick="history.back()" class="btn btn-outline">
                <i class="fas fa-times"></i> Cancel
            </button>
            <button type="submit" class="btn btn-primary">
                <i class="fas fa-paper-plane"></i> Create Thread
            </button>
        </div>
    </form>
</div>

<script>
document.getElementById('thread-form').addEventListener('submit', async function(e) {
    e.preventDefault();
    
    const formData = new FormData(this);
    const selectedTags = Array.from(formData.getAll('tags')).map(id => parseInt(id));
    
    const data = {
        title: formData.get('title'),
        description: formData.get('description'),
        tags: selectedTags
    };
    
    const errorDiv = document.getElementById('error-message');
    
    try {
        const response = await fetch('/api/threads', {
            method: 'POST',
            headers: {
                'Content-Type': 'application/json',
            },
            body: JSON.stringify(data)
        });
        
        if (response.ok) {
            const result = await response.json();
            window.location.href = `/threads/${result.thread.id}`;
        } else {
            const result = await response.text();
            errorDiv.textContent = result;
            errorDiv.style.display = 'block';
        }
    } catch (error) {
        errorDiv.textContent = 'Failed to create thread. Please try again.';
        errorDiv.style.display = 'block';
    }
});
</script>
{{end}}